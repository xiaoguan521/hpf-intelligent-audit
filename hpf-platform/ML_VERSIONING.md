# MLOpsï¼šæ¨¡å‹ç‰ˆæœ¬ç®¡ç†æŒ‡å—

## ğŸ“¦ æ–‡ä»¶ç»“æ„

è®­ç»ƒå®Œæˆåï¼Œ`models/` ç›®å½•åŒ…å«ï¼š

```
models/
â”œâ”€â”€ overdue_model_20260119_135318_f1_0.6205.pkl  # ç‰ˆæœ¬åŒ–æ¨¡å‹
â”œâ”€â”€ overdue_model_20260120_102145_f1_0.6387.pkl  # ç¬¬äºŒè½®è®­ç»ƒ
â”œâ”€â”€ overdue_model_20260121_083022_f1_0.6534.pkl  # ç¬¬ä¸‰è½®è®­ç»ƒ
â”œâ”€â”€ overdue_model_latest.pkl                      # æŒ‡å‘æœ€ä½³ç‰ˆæœ¬ï¼ˆç”Ÿäº§ç”¨ï¼‰
â””â”€â”€ training_history.json                         # æ‰€æœ‰è®­ç»ƒè®°å½•
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è®­ç»ƒæ¨¡å‹ï¼ˆè‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†ï¼‰

```bash
# åœ¨å®¹å™¨å†…
python hpf_platform/ml/train.py
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ’¾ æ¨¡å‹å·²ä¿å­˜: /app/hpf-platform/hpf_platform/ml/models/overdue_model_20260119_135318_f1_0.6205.pkl
ğŸ’¾ æœ€æ–°æ¨¡å‹: /app/hpf-platform/hpf_platform/ml/models/overdue_model_latest.pkl
ğŸ“Š è®­ç»ƒå†å²å·²æ›´æ–°: /app/hpf-platform/hpf_platform/ml/models/training_history.json
âœ… è¿™æ˜¯é¦–æ¬¡è®­ç»ƒï¼
```

### 2. æŸ¥çœ‹æ‰€æœ‰è®­ç»ƒè®°å½•

```bash
python hpf_platform/ml/compare_models.py
```

**è¾“å‡º**ï¼š
```
ğŸ“Š å…±æœ‰ 3 è½®è®­ç»ƒè®°å½•

+----+-------------------+--------------+--------+-------------+----------+------------+-----------+
|  # | æ—¶é—´              | æ¨¡å‹         | F1     | Precision   | Recall   | Accuracy   | æ•°æ®é‡    |
+====+===================+==============+========+=============+==========+============+===========+
|  1 | 20260119_135318   | CatBoost     | 0.6205 | 0.6042      | 0.6376   | 0.6288     | 80000     |
|  2 | 20260120_102145   | XGBoost      | 0.6387 | 0.6224      | 0.6556   | 0.6431     | 80000     |
|  3 | 20260121_083022   | CatBoost     | 0.6534 | 0.6398      | 0.6675   | 0.6587     | 100000    |
+----+-------------------+--------------+--------+-------------+----------+------------+-----------+

ğŸ† å†å²æœ€ä½³:
   æ—¶é—´: 20260121_083022
   æ¨¡å‹: CatBoost
   F1-Score: 0.6534
   æ–‡ä»¶: overdue_model_20260121_083022_f1_0.6534.pkl
```

### 3. å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬

```bash
python hpf_platform/ml/compare_models.py --compare 1 3
```

**è¾“å‡º**ï¼š
```
ğŸ” å¯¹æ¯”åˆ†æ: ç¬¬1è½® vs ç¬¬3è½®

+----------------+----------+----------+---------------------+
| æŒ‡æ ‡           | è½®æ¬¡ 1   | è½®æ¬¡ 3   | å˜åŒ–                |
+================+==========+==========+=====================+
| F1 Score       | 0.6205   | 0.6534   | ğŸŸ¢ +0.0329 (+5.30%) |
| Precision      | 0.6042   | 0.6398   | ğŸŸ¢ +0.0356 (+5.89%) |
| Recall         | 0.6376   | 0.6675   | ğŸŸ¢ +0.0299 (+4.69%) |
| Accuracy       | 0.6288   | 0.6587   | ğŸŸ¢ +0.0299 (+4.75%) |
+----------------+----------+----------+---------------------+

âœ¨ æ€»ä½“æå‡: +0.0329 (+5.30%)
```

### 4. æŸ¥çœ‹æ€§èƒ½è¶‹åŠ¿

```bash
python hpf_platform/ml/compare_models.py --trend
```

**è¾“å‡º**ï¼š
```
ğŸ“ˆ F1-Score è¿›æ­¥è¶‹åŠ¿:

è½®æ¬¡  |  F1-Score  |  æ¨¡å‹ç±»å‹       |  è¶‹åŠ¿
------------------------------------------------------------
  1  |  0.6205    |  CatBoost       |   â€”  (åŸºçº¿)
  2  |  0.6387    |  XGBoost        |   â¬†ï¸  +0.0182
  3  |  0.6534    |  CatBoost       |   â¬†ï¸  +0.0147

âœ¨ æ€»ä½“æå‡: +0.0329 (+5.30%)
```

---

## ğŸ’¡ å¤šè½®ä¼˜åŒ–ç­–ç•¥

### ç¬¬1è½®ï¼šå»ºç«‹åŸºçº¿
```bash
python scripts/generate_mock_data.py  # é»˜è®¤10ä¸‡æ•°æ®
cd dbt_project && dbt run && cd ..
python hpf_platform/ml/train.py        # GridSearch å¹¿æ³›æœç´¢
```

**é¢„æœŸ**ï¼šF1 = 0.60-0.62

### ç¬¬2è½®ï¼šè°ƒæ•´æ•°æ®
```bash
# ä¿®æ”¹ generate_mock_data.py
N_CUSTOMERS = 200000  # å¢åŠ åˆ°20ä¸‡

python scripts/generate_mock_data.py
cd dbt_project && dbt run && cd ..
python hpf_platform/ml/train.py
```

**é¢„æœŸ**ï¼šF1 = 0.62-0.64 (+2-4%)

### ç¬¬3è½®ï¼šä¼˜åŒ–ç‰¹å¾
```bash
# åœ¨ features.py ä¸­æ·»åŠ æ–°äº¤å‰ç‰¹å¾
# ä¾‹å¦‚: income_age_interaction, credit_dti_ratio

python hpf_platform/ml/train.py
```

**é¢„æœŸ**ï¼šF1 = 0.64-0.66 (+2-4%)

### ç¬¬4è½®ï¼šé›†æˆå­¦ä¹ 
```bash
# ä¿®æ”¹ train.pyï¼Œå¯ç”¨ Voting Ensemble
# æˆ–å®ç° Stacking

python hpf_platform/ml/train.py
```

**é¢„æœŸ**ï¼šF1 = 0.66-0.68 (+2-3%)

---

## ğŸ¯ ç›®æ ‡è®¾å®š

| é˜¶æ®µ | F1-Score | çŠ¶æ€ | å»ºè®®è¡ŒåŠ¨ |
|------|----------|------|----------|
| åŸºçº¿ | 0.56-0.60 | âœ… å·²å®Œæˆ | - |
| ä¼˜ç§€ | 0.60-0.65 | âœ… å·²å®Œæˆ | - |
| **å“è¶Š** | 0.65-0.70 | ğŸ¯ å½“å‰ç›®æ ‡ | å¢åŠ æ•°æ®+ä¼˜åŒ–ç‰¹å¾ |
| é¡¶å°– | 0.70-0.75 | ğŸš€ ç»ˆæç›®æ ‡ | Stacking+æ·±åº¦å­¦ä¹  |

---

## ğŸ“Š training_history.json æ ¼å¼

```json
[
  {
    "timestamp": "20260119_135318",
    "model_type": "CatBoost",
    "f1_score": 0.6205,
    "precision": 0.6042,
    "recall": 0.6376,
    "accuracy": 0.6288,
    "data_size": 80000,
    "train_size": 64000,
    "test_size": 16000,
    "n_features": 15,
    "model_path": "overdue_model_20260119_135318_f1_0.6205.pkl"
  }
]
```

---

## ğŸ”„ å›æ»šåˆ°å†å²ç‰ˆæœ¬

```bash
# æŸ¥çœ‹æ‰€æœ‰Version
ls -lh models/overdue_model_*.pkl

# åŠ è½½ç‰¹å®šç‰ˆæœ¬
python -c "
import joblib
model = joblib.load('models/overdue_model_20260119_135318_f1_0.6205.pkl')
print('æ¨¡å‹åŠ è½½æˆåŠŸï¼')
"
```

---

## ğŸ“¥ ç”Ÿäº§éƒ¨ç½²

**å§‹ç»ˆä½¿ç”¨ `overdue_model_latest.pkl`**ï¼š

```python
# åœ¨APIæˆ–åº”ç”¨ä¸­
import joblib

model = joblib.load('models/overdue_model_latest.pkl')
prediction = model.predict(new_data)
```

è¿™æ ·æ¯æ¬¡è®­ç»ƒåï¼Œå¦‚æœæ–°æ¨¡å‹æ›´å¥½ï¼Œ`latest` ä¼šè‡ªåŠ¨æ›´æ–°ã€‚
